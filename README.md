# 🧠 法律文档 → Anki 闪卡助手（Streamlit + DeepSeek + genanki）

一个本地运行的智能法律学习工具：上传法律相关文档（docx/pdf/txt）→ **LLM智慧归纳** → 一键导出 `.apkg` 直接导入官方 Anki。

## ✨ 新增核心功能（2024优化版）

### 🤖 LLM智慧归纳
- **智能理解**: 大模型对法律知识点进行深度理解和归纳总结
- **教育优化**: 将复杂法律概念转化为易于记忆的学习卡片
- **保持原意**: 在忠实原文基础上进行适当丰富和重构

### 🔍 语义理解关键词抽取
- **超越匹配**: 不仅精确匹配，更能理解法律概念的语义关联
- **智能发现**: 自动识别同义词、相关概念和法律关联
- **全面覆盖**: 发现隐含的相关内容，提高知识召回率

### ✅ 用户确认机制
- **导出前确认**: 用户必须确认最终卡片内容，确保完全控制
- **归纳过程展示**: 透明展示LLM的归纳思路，增强可信度
- **选择性导出**: 支持预览和选择性导出，灵活掌控学习内容

## 🎯 核心优势

- **只做"基于原文的排版组织"**，不补充外部知识/不臆测
- **LLM智慧加持**，支持 `DeepSeek-V3`、`DeepSeek-R1` 智能归纳
- **语义理解技术**，发现传统关键词匹配遗漏的相关内容
- **本地运行**，保护法律文档隐私，无需上传云端
- **一键导出**，直接生成标准 `.apkg` 格式，兼容所有Anki版本

## 🚀 快速开始（Windows / uv）

### 环境准备
```powershell
# 1. 进入项目目录
cd C:\CODE\python\anki_assis

# 2. 创建虚拟环境
uv venv .venv

# 3. 安装依赖
uv pip install -r requirements.txt -p .venv

# 4. 配置 API（两种方式）
# 方式 A：直接在应用左侧边栏输入
# 方式 B：使用 .env 文件
```

### 配置示例
```ini
# .env 文件（放在项目根目录）
DEEPSEEK_BASE_URL=https://api.deepseek.com/v1
DEEPSEEK_API_KEY=替换为你的Key
```

### 启动应用
```powershell
.venv\Scripts\python -m streamlit run app/streamlit_app.py --server.port 8501
```
- 打开浏览器访问：`http://localhost:8501`

## 📖 使用流程

### Step 1 - 智能文档处理
- **多格式支持**: 上传 `pdf/docx/txt` 多个文件
- **智能关键词**: 输入关键词，系统将基于语义理解发现相关内容
- **模型选择**: 
  - 抽取模型：默认 `DeepSeek-V3`（支持语义理解）
  - 制卡模型：可选 `DeepSeek-V3` 或 `DeepSeek-R1`（支持智慧归纳）

### Step 2 - LLM智慧制卡
- **语义抽取**: 系统自动发现关键词的语义关联内容
- **智慧归纳**: LLM对复杂法律概念进行教育性归纳总结
- **质量保障**: 质量分过滤 + 文本相似度去重
- **过程透明**: 展示LLM归纳思路，增强学习效果

### Step 3 - 用户确认与导出
- **内容预览**: 查看LLM归纳过程和最终卡片内容
- **确认导出**: 用户确认无误后导出到Anki
- **一键完成**: 生成标准 `.apkg` 文件，直接导入使用

## 🏗️ 技术架构

### 核心组件
```
anki_assis/
├─ app/
│  └─ streamlit_app.py         # 前端 UI（新增确认机制）
├─ pipeline/
│  ├─ graph.py                 # 管线入口（集成LLM智慧归纳）
│  └─ nodes/
│     ├─ induction.py          # NEW: LLM智慧归纳与语义理解
│     ├─ extract.py            # 增强: 语义理解关键词抽取
│     ├─ generate_cards.py     # 增强: LLM智慧卡片生成
│     └─ quality.py            # 质量控制与去重
├─ llm/
│  └─ client.py                # DeepSeek客户端封装
├─ anki/
│  ├─ templates.py             # genanki模板与样式
│  └─ exporter.py              # Anki包导出
├─ models/
│  └─ schemas.py               # 数据模型（新增LLM归纳字段）
```

### 新增技术特性
- **LLM智慧归纳**: 大模型对法律知识点的深度理解和教育性重构
- **语义理解**: 超越关键词匹配，发现概念间的语义关联
- **用户确认**: 导出前的最终确认机制，确保内容准确性

### 技术约束满足
- ✅ **Python为主**: 完全基于现有Python代码结构
- ✅ **Streamlit前端**: 保持现有界面，仅增强确认功能
- ✅ **genanki制卡**: 保持原有卡片生成和导出逻辑
- ✅ **LLM调用方式**: 沿用现有DeepSeekClient，无需改动底层
- ✅ **最小改动原则**: 避免过度工程化，保持代码简洁可运行

## ⚙️ 智能参数配置

### 质量控制（可调）
- 去重相似度阈值：`0.88`（默认）
- 最低质量分：`0.65`（默认）
- 每知识点最多卡片数：`3`（默认）

### LLM智能参数
- 语义理解强度：自动调节，发现隐含关联
- 归纳教育性：保持原意基础上提升学习效果
- 过程透明度：展示归纳思路，增强可信度

## 📊 智能数据结构

### 新增智能字段
- `llm_induction`: LLM归纳过程描述
- `user_confirmed`: 用户确认状态
- `semantic_matches`: 语义匹配的关键词列表
- `induction_quality`: LLM归纳质量评分

### 卡片智能增强
- 展现LLM的归纳智慧和学习优化思路
- 保持来源可追溯，证据片段完整
- 支持用户最终确认，确保内容准确性

## 🔍 常见问题（FAQ）

### Q: LLM归纳会改变原意吗？
A: 不会！系统严格遵循"基于原文"原则，LLM只在保持原意基础上进行教育性重构。

### Q: 语义理解发现的内容准确吗？
A: 高准确度！系统会综合直接匹配、同义词、法律关联等多维度判断相关性。

### Q: 用户确认是必须的吗？
A: 是的！这是核心安全机制，确保用户对最终学习内容有完全控制权。

### Q: 会影响现有功能吗？
A: 完全不会！所有优化都是向后兼容的增强，原有功能保持不变。

## 🗺️ 路线图（Roadmap）

### 近期优化
- ✅ **LLM智慧归纳** - 已完成
- ✅ **语义理解抽取** - 已完成  
- ✅ **用户确认机制** - 已完成

### 未来规划
- **多模态支持**: 支持图表、公式的智能理解
- **个性化学习**: 基于用户反馈的智能优化
- **知识图谱**: 构建法律概念间的智能关联网络

---

**现在就开始你的智能法律学习之旅吧！** 🎯
